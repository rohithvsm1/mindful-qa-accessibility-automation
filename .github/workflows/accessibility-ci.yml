name: Playwright WCAG CI/CD
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
    
    - name: Install deps (npm install fallback)
      run: |
        if [ -f package-lock.json ]; then
          npm ci
        else
          npm install
        fi
    
    - name: Check Playwright config
      run: |
        ls -la playwright.config.* || echo "No playwright config found"
        ls -la tests/ || echo "No tests folder"
        ls -la *.spec.* || echo "No test files"
    
    - name: Install Playwright browsers
      run: npx playwright install --with-deps
      continue-on-error: true
    
    - name: List installed browsers
      run: npx playwright --version
    
    - name: Run tests (if exist)
      run: |
        if npx playwright test --list; then
          npx playwright test
        else
          echo "No tests found - skipping"
          exit 0
        fi
      continue-on-error: true
    
    - name: Generate report
      if: always()
      run: npx playwright show-report || echo "No report generated"
    
    - name: Upload artifacts
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: accessibility-artifacts
        path: |
          playwright-report/
          test-results/
          *.png
